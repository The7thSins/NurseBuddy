<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NurseBuddy | เข้าสู่ระบบ</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sarabun', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
    }

    .login-container {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 450px;
      padding: 20px;
    }

    .login-wrapper {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      text-align: center;
      position: relative;
      overflow: hidden;
      will-change: transform;
      transform: translateZ(0);
    }

    .login-wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .logo-section {
      margin-bottom: 30px;
    }

    .logo-circle {
      width: 70px;
      height: 70px;
      margin: 0 auto 15px auto;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      font-weight: 700;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .logo-text {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }

    .logo-subtitle {
      font-size: 15px;
      color: #64748b;
      margin-bottom: 35px;
      line-height: 1.4;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 25px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 12px;
      padding: 4px;
    }

    .auth-tab {
      flex: 1;
      padding: 10px 15px;
      text-align: center;
      cursor: pointer;
      font-weight: 600;
      color: #64748b;
      border-radius: 10px;
      transition: all 0.15s ease;
    }

    .auth-tab.active {
      color: white;
      background: linear-gradient(135deg, #667eea, #764ba2);
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
    }

    .form-container {
      position: relative;
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .input-group {
      margin-bottom: 18px;
      position: relative;
      text-align: left;
    }

    .input-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
    }

    .input-group input, .input-group select {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 15px;
      transition: border-color 0.2s ease;
      background: rgba(255, 255, 255, 0.9);
    }

    .input-group input:focus, .input-group select:focus {
      border-color: #667eea;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    .password-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #64748b;
      font-size: 16px;
      transition: color 0.2s ease;
    }

    .password-toggle:hover {
      color: #667eea;
    }

    .auth-btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .auth-btn:hover {
      transform: translateY(-1px) translateZ(0);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
    }

    .auth-btn:active {
      transform: translateY(0) translateZ(0);
    }

    .auth-btn:disabled {
      background: #94a3b8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .register-btn {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border: 2px solid #667eea;
    }

    .register-btn:hover {
      background: rgba(102, 126, 234, 0.15);
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
    }

    .remember-option {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 18px;
      font-size: 14px;
      color: #64748b;
    }

    .remember-option input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 18px;
      font-size: 14px;
      display: none;
      border-left: 4px solid;
    }

    .error-message {
      background: rgba(220, 38, 38, 0.1);
      color: #dc2626;
      border-left-color: #dc2626;
    }

    .success-message {
      background: rgba(5, 150, 105, 0.1);
      color: #059669;
      border-left-color: #059669;
    }

    .info-message {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
      border-left-color: #3b82f6;
    }

    .online-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
      padding: 10px 15px;
      background: rgba(5, 150, 105, 0.1);
      border-radius: 8px;
      font-size: 13px;
      color: #059669;
    }

    .online-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #059669;
    }

    .features-section {
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid rgba(100, 116, 139, 0.2);
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .feature-item {
      text-align: center;
      padding: 12px 6px;
      border-radius: 10px;
      background: rgba(102, 126, 234, 0.05);
      border: 1px solid rgba(102, 126, 234, 0.1);
      transition: transform 0.2s ease;
    }

    .feature-item:hover {
      transform: translateY(-2px);
    }

    .feature-icon {
      font-size: 20px;
      margin-bottom: 6px;
    }

    .feature-text {
      font-size: 11px;
      color: #64748b;
      font-weight: 500;
    }

    .role-info {
      margin-top: 18px;
      padding: 18px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 10px;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }

    .role-info h4 {
      color: #4c1d95;
      margin-bottom: 12px;
      font-size: 15px;
    }

    .role-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px;
      background: white;
      border-radius: 6px;
      font-size: 13px;
    }

    .role-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      color: white;
    }

    .role-admin { background: #ef4444; }
    .role-nurse { background: #059669; }

    .developer-info {
      margin-top: 20px;
      padding-top: 18px;
      border-top: 1px solid rgba(100, 116, 139, 0.2);
      text-align: center;
    }

    .developer-info p {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 4px;
    }

    .developer-info .main-text {
      font-size: 13px;
      color: #64748b;
      font-weight: 600;
    }

    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      border-radius: 20px;
      z-index: 10;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #e5e7eb;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .server-info {
      margin-top: 18px;
      padding: 15px;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
      font-size: 12px;
    }

    .server-info h5 {
      color: #1e40af;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .server-info p {
      color: #1e40af;
      margin-bottom: 5px;
    }

    @media (max-width: 768px) {
      .login-container {
        padding: 10px;
        max-width: 100%;
      }

      .login-wrapper {
        padding: 25px 18px;
        margin: 10px;
        border-radius: 18px;
      }

      .logo-text {
        font-size: 24px;
      }

      .logo-circle {
        width: 60px;
        height: 60px;
        font-size: 24px;
      }

      .features-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .auth-tab {
        padding: 8px 12px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .login-wrapper {
        padding: 20px 15px;
        margin: 5px;
      }

      .logo-text {
        font-size: 22px;
      }

      .logo-circle {
        width: 55px;
        height: 55px;
        font-size: 22px;
      }

      .features-grid {
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="login-container">
    <div class="login-wrapper">
      <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
      </div>

      <div class="logo-section">
        <div class="logo-circle">🏥</div>
        <div class="logo-text">NurseBuddy</div>
        <div class="logo-subtitle">ระบบติดตามสารน้ำ<br>สำหรับโรงพยาบาล</div>
      </div>

      <div class="online-status">
        <div class="online-dot"></div>
        <span>🌐 ระบบออนไลน์</span>
      </div>

      <!-- Auth Tabs -->
      <div class="auth-tabs">
        <div class="auth-tab active" onclick="switchTab('login')">🔓 เข้าสู่ระบบ</div>
        <div class="auth-tab" onclick="switchTab('register')">📝 สมัครสมาชิก</div>
      </div>

      <div class="form-container">
        <!-- Login Form -->
        <form id="loginForm" class="auth-form active" onsubmit="return login(event);">
          <div class="input-group">
            <label for="username">รหัสผ่าน / ชื่อผู้ใช้</label>
            <input type="text" id="username" placeholder="กรอกรหัส 0000 สำหรับแอดมิน" required />
          </div>

          <div class="input-group" style="display: none;" id="passwordGroup">
            <label for="password">รหัสผ่าน</label>
            <div class="password-container">
              <input type="password" id="password" placeholder="กรอกรหัสผ่าน" />
              <button type="button" class="password-toggle" onclick="togglePassword('password')">
                <span>👁️</span>
              </button>
            </div>
          </div>

          <div class="remember-option">
            <input type="checkbox" id="rememberMe">
            <label for="rememberMe">จดจำข้อมูลการเข้าสู่ระบบ</label>
          </div>

          <button type="submit" class="auth-btn" id="loginBtn">🔓 เข้าสู่ระบบ</button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="auth-form" onsubmit="return register(event);">
          <div class="input-group">
            <label for="regUsername">ชื่อผู้ใช้ (ภาษาอังกฤษ)</label>
            <input type="text" id="regUsername" placeholder="เช่น nurse03, doctor01" required />
          </div>

          <div class="input-group">
            <label for="regPassword">รหัสผ่าน</label>
            <div class="password-container">
              <input type="password" id="regPassword" placeholder="รหัสผ่านอย่างน้อย 6 ตัว" required minlength="6" />
              <button type="button" class="password-toggle" onclick="togglePassword('regPassword')">
                <span>👁️</span>
              </button>
            </div>
          </div>

          <div class="input-group">
            <label for="regFullname">ชื่อ-นามสกุล (ภาษาไทย)</label>
            <input type="text" id="regFullname" placeholder="เช่น พยาบาลสมหญิง ใจดี" required />
          </div>

          <div class="input-group">
            <label for="regRole">บทบาท</label>
            <select id="regRole">
              <option value="nurse">👩‍⚕️ พยาบาล</option>
              <option value="doctor">👨‍⚕️ บุคลากรอื่น ๆ</option>
            </select>
          </div>

          <button type="submit" class="auth-btn register-btn">📝 ส่งคำขอสมัคร</button>
        </form>
      </div>

      <!-- Messages -->
      <div id="errorMsg" class="message error-message"></div>
      <div id="successMsg" class="message success-message"></div>
      <div id="infoMsg" class="message info-message"></div>

      <div class="role-info">
        <h4>🔐 บทบาทผู้ใช้</h4>
        <div class="role-item">
          <span class="role-badge role-admin">ADMIN</span>
          <span>จัดการระบบ อนุมัติสมาชิก</span>
        </div>
        <div class="role-item">
          <span class="role-badge role-nurse">NURSE</span>
          <span>จัดการเตียง บันทึกข้อมูล</span>
        </div>
      </div>

      <div class="features-section">
        <div class="features-grid">
          <div class="feature-item">
            <div class="feature-icon">🌐</div>
            <div class="feature-text">ระบบออนไลน์</div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">🔄</div>
            <div class="feature-text">ซิงค์ข้อมูล</div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">📱</div>
            <div class="feature-text">ใช้งานง่าย</div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">🔒</div>
            <div class="feature-text">ปลอดภัย</div>
          </div>
        </div>
      </div>

      <div class="server-info">
        <h5>💡 วิธีใช้งาน</h5>
        <p><strong>แอดมิน:</strong> รหัส 0000</p>
        <p><strong>พยาบาล:</strong> สมัครสมาชิก รอการอนุมัติ</p>
      </div>

      <div class="developer-info">
        <p class="main-text">💻 พัฒนาโดย จักรพงษ์ แอบไธสง และคณะ</p>
        <p class="sub-text">NurseBuddy v2.0</p>
      </div>
    </div>
  </div>

  <script>
    // กำหนดข้อมูลผู้ใช้เริ่มต้น
    const DEFAULT_ADMIN = {
      username: "0000",
      password: "0000", 
      role: "admin", 
      fullname: "ผู้ดูแลระบบหลัก",
      permissions: ["all"],
      isDefault: true
    };

    const DEFAULT_USERS = [
      DEFAULT_ADMIN,
      { 
        username: "nurse01", 
        password: "nurse123", 
        role: "nurse", 
        fullname: "พยาบาลศรีวรรณ",
        permissions: ["bed_management", "patient_care"],
        approved: true
      },
      { 
        username: "nurse02", 
        password: "nurse456", 
        role: "nurse", 
        fullname: "พยาบาลกานดา",
        permissions: ["bed_management", "patient_care"],
        approved: true
      }
    ];

    let currentTab = 'login';

    function initializeSystem() {
      // ตรวจสอบและสร้างข้อมูลผู้ใช้เริ่มต้น
      let users = JSON.parse(localStorage.getItem("systemUsers") || "null");

      if (!users || users.length === 0) {
        users = DEFAULT_USERS;
        localStorage.setItem("systemUsers", JSON.stringify(users));
        console.log("✅ ตั้งค่าผู้ใช้เริ่มต้นแล้ว");
      }

      // ตรวจสอบว่ามี admin หรือไม่
      const hasAdmin = users.some(u => u.role === "admin" || u.username === "0000");
      if (!hasAdmin) {
        users.unshift(DEFAULT_ADMIN);
        localStorage.setItem("systemUsers", JSON.stringify(users));
        console.log("🛠️ เพิ่ม admin กลับเข้าระบบ");
      }

      // โหลดข้อมูลที่จดจำไว้
      loadRememberedData();
    }

    function switchTab(tab) {
      currentTab = tab;

      // อัพเดท tabs
      document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');

      // อัพเดท forms
      document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
      document.getElementById(tab === 'login' ? 'loginForm' : 'registerForm').classList.add('active');

      // ล้างข้อความ
      clearMessages();
    }

    function togglePassword(inputId) {
      const input = document.getElementById(inputId);
      const icon = input.nextElementSibling.querySelector('span');

      if (input.type === 'password') {
        input.type = 'text';
        icon.textContent = '🙈';
      } else {
        input.type = 'password';
        icon.textContent = '👁️';
      }
    }

    function showMessage(message, type = 'error') {
      clearMessages();

      const messageEl = document.getElementById(type + 'Msg');
      messageEl.textContent = message;
      messageEl.style.display = 'block';

      // ซ่อนข้อความอัตโนมัติหลัง 5 วินาที
      setTimeout(() => {
        messageEl.style.display = 'none';
      }, 5000);
    }

    function clearMessages() {
      document.getElementById('errorMsg').style.display = 'none';
      document.getElementById('successMsg').style.display = 'none';
      document.getElementById('infoMsg').style.display = 'none';
    }

    function showLoading(show = true) {
      const overlay = document.getElementById('loadingOverlay');
      const loginBtn = document.getElementById('loginBtn');

      overlay.style.display = show ? 'flex' : 'none';

      if (loginBtn) {
        loginBtn.disabled = show;
        loginBtn.textContent = show ? '⏳ กำลังเข้าสู่ระบบ...' : '🔓 เข้าสู่ระบบ';
      }
    }

    function loadRememberedData() {
      const remembered = JSON.parse(localStorage.getItem("rememberedLogin") || "null");
      if (remembered) {
        document.getElementById("username").value = remembered.username;
        document.getElementById("rememberMe").checked = true;

        // แสดงช่องรหัสผ่านถ้าไม่ใช่ 0000
        if (remembered.username !== "0000") {
          document.getElementById("passwordGroup").style.display = "block";
          if (remembered.password) {
            document.getElementById("password").value = remembered.password;
          }
        }
      }
    }

    function saveRememberedData(username, password = "") {
      if (document.getElementById("rememberMe").checked) {
        localStorage.setItem("rememberedLogin", JSON.stringify({
          username: username,
          password: password
        }));
      } else {
        localStorage.removeItem("rememberedLogin");
      }
    }

    // ตรวจสอบการเปลี่ยนแปลงของ username
    document.getElementById("username").addEventListener("input", function(e) {
      const username = e.target.value.trim();
      const passwordGroup = document.getElementById("passwordGroup");
      const passwordInput = document.getElementById("password");

      if (username === "0000") {
        passwordGroup.style.display = "none";
        passwordInput.removeAttribute("required");
      } else {
        passwordGroup.style.display = "block";
        passwordInput.setAttribute("required", "");
      }
    });

    function login(event) {
      event.preventDefault();
      clearMessages();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!username) {
        showMessage("กรุณากรอกรหัสผ่าน หรือ ชื่อผู้ใช้", 'error');
        return false;
      }

      // ตรวจสอบกรณีพิเศษสำหรับแอดมิน
      if (username === "0000") {
        loginAdmin();
        return false;
      }

      if (!password) {
        showMessage("กรุณากรอกรหัสผ่าน", 'error');
        return false;
      }

      showLoading(true);

      // จำลอง delay การเข้าสู่ระบบ
      setTimeout(() => {
        try {
          const users = JSON.parse(localStorage.getItem("systemUsers") || "[]");
          const user = users.find(u => 
            (u.username === username && u.password === password) && 
            (u.approved !== false)
          );

          if (user) {
            if (user.approved === false) {
              showLoading(false);
              showMessage("บัญชีของคุณยังไม่ได้รับการอนุมัติ กรุณารอการอนุมัติจากผู้ดูแลระบบ", 'info');
              return;
            }

            // บันทึก session
            const sessionData = {
              ...user,
              loginTime: new Date().toISOString(),
              sessionId: Date.now().toString()
            };

            sessionStorage.setItem("currentUser", JSON.stringify(sessionData));
            saveRememberedData(username, password);

            showMessage(`เข้าสู่ระบบสำเร็จ ยินดีต้อนรับ ${user.fullname}`, 'success');

            // รอ 1 วินาทีแล้วไปหน้า dashboard
            setTimeout(() => {
              window.location.href = "dashboard.html";
            }, 800);

          } else {
            showLoading(false);
            showMessage("ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง หรือบัญชียังไม่ได้รับการอนุมัติ", 'error');
          }
        } catch (error) {
          showLoading(false);
          console.error("Login error:", error);
          showMessage("เกิดข้อผิดพลาดในการเข้าสู่ระบบ กรุณาลองใหม่", 'error');
        }
      }, 1000);

      return false;
    }

    function loginAdmin() {
      showLoading(true);

      setTimeout(() => {
        const adminSession = {
          ...DEFAULT_ADMIN,
          loginTime: new Date().toISOString(),
          sessionId: Date.now().toString()
        };

        sessionStorage.setItem("currentUser", JSON.stringify(adminSession));
        saveRememberedData("0000");

        showMessage(`เข้าสู่ระบบแอดมินสำเร็จ ยินดีต้อนรับ ${DEFAULT_ADMIN.fullname}`, 'success');

        setTimeout(() => {
          window.location.href = "dashboard.html";
        }, 800);
      }, 600);
    }

    function register(event) {
      event.preventDefault();
      clearMessages();

      const username = document.getElementById("regUsername").value.trim();
      const password = document.getElementById("regPassword").value.trim();
      const fullname = document.getElementById("regFullname").value.trim();
      const role = document.getElementById("regRole").value;

      if (!username || !password || !fullname) {
        showMessage("กรุณากรอกข้อมูลให้ครบถ้วน", 'error');
        return false;
      }

      // ตรวจสอบรูปแบบชื่อผู้ใช้
      if (!/^[a-zA-Z0-9_]+$/.test(username)) {
        showMessage("ชื่อผู้ใช้ต้องเป็นภาษาอังกฤษ ตัวเลข หรือ _ เท่านั้น", 'error');
        return false;
      }

      if (username === "0000" || username.toLowerCase() === "admin") {
        showMessage("ไม่สามารถใช้ชื่อผู้ใช้นี้ได้", 'error');
        return false;
      }

      showLoading(true);

      setTimeout(() => {
        try {
          let users = JSON.parse(localStorage.getItem("systemUsers") || "[]");

          // ตรวจสอบชื่อผู้ใช้ซ้ำ
          if (users.some(user => user.username === username)) {
            showLoading(false);
            showMessage("ชื่อผู้ใช้นี้มีอยู่ในระบบแล้ว กรุณาใช้ชื่ออื่น", 'error');
            return;
          }

          // สร้างผู้ใช้ใหม่
          const newUser = {
            username: username,
            password: password,
            fullname: fullname,
            role: role,
            permissions: role === "nurse" ? ["bed_management", "patient_care"] : ["patient_view"],
            approved: false, // รอการอนุมัติ
            registeredAt: new Date().toISOString(),
            status: "pending"
          };

          users.push(newUser);
          localStorage.setItem("systemUsers", JSON.stringify(users));

          showLoading(false);
          showMessage("ส่งคำขอสมัครสมาชิกเรียบร้อยแล้ว! รอการอนุมัติจากผู้ดูแลระบบ", 'success');

          // ล้างฟอร์ม
          document.getElementById("registerForm").reset();

          // เปลี่ยนไปหน้า login หลัง 3 วินาที
          setTimeout(() => {
            switchTab('login');
            showMessage("คุณสามารถเข้าสู่ระบบได้หลังจากได้รับการอนุมัติแล้ว", 'info');
          }, 2500);

        } catch (error) {
          showLoading(false);
          console.error("Register error:", error);
          showMessage("เกิดข้อผิดพลาดในการสมัครสมาชิก กรุณาลองใหม่", 'error');
        }
      }, 800);

      return false;
    }

    // ตรวจสอบว่าผู้ใช้เข้าสู่ระบบแล้วหรือยัง
    function checkExistingSession() {
      const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
      if (currentUser) {
        // ถ้าเข้าสู่ระบบแล้ว ให้ไปหน้า dashboard ทันที
        window.location.href = 'dashboard.html';
      }
    }

    // เริ่มต้นระบบเมื่อหน้าเว็บโหลด
    document.addEventListener("DOMContentLoaded", function() {
      initializeSystem();
      checkExistingSession();

      // เพิ่มการกดปุ่ม Enter
      document.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
          const activeForm = document.querySelector('.auth-form.active');
          if (activeForm) {
            const submitEvent = new Event('submit');
            activeForm.dispatchEvent(submitEvent);
          }
        }
      });
    });
  </script>
</body>
</html>